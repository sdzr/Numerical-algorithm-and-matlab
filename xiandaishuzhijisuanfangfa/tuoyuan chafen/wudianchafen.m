%解矩形域上散度型方程混合边界条件的五点差分实现
%范围在D=[-1 1]*[-2 2];
h=1/10;
I=2/h;
J=4/h;
%矩阵A的构造

%非边界点的系数值赋给矩阵A
for i=2:1:I
    for j=2:1:J
    A(i+(I+1)*(j-1),i+(I+1)*(j-1))=-(p(-1+(i-1+1/2)*h,-2+(j-1)*h)+p(-1+(i-1-1/2)*h,-2+(j-1)*h)+p(-1+(i-1)*h,-2+(j-1+1/2)*h)+p(-1+(i-1)*h,-2+(j-1-1/2)*h)+h*h*q(-1+(i-1)*h,-2+(j-1)*h));
    A(i+(I+1)*(j-1),i-1+(I+1)*(j-1))=p(-1+(i-1-1/2)*h,-2+h*(j-1));
    A(i+(I+1)*(j-1),i+1+(I+1)*(j-1))=p(-1+(i-1+1/2)*h,-2+h*(j-1));
    A(i+(I+1)*(j-1),i+(I+1)*(j-2))=p(-1+(i-1)*h,-2+h*(j-1-1/2));
    A(i+(I+1)*(j-1),i+(I+1)*j)=p(-1+(i-1)*h,-2+h*(j-1+1/2));
    b(i+(I+1)*(j-1))=-h*h*f(-1+h*(i-1),-2+h*(j-1));
    end
end

%左边界：x=-1上的点
%fh2=h(x,-2),h2=h(x,2),fh1=h(-1,y),fh1=h(1,y)
 i=1;
 for j=1:1:J
     A(i+(j-1)*(I+1),i+(j-1)*(I+1))=p(-1,-2+h*(j-1))-h*fh1(-2+h*(j-1));%h1=h(-1,y)
     A(i+(j-1)*(I+1),i+1+(j-1)*(I+1))=-p(-1,-2+h*(j-1));
     b(i+(j-1)*(I+1))=fg1(-2+h*(j-1));
 end
 %上边界y=2上的点
 j=J+1;
 for i=1:1:I
     A(i+(j-1)*(I+1),i+(j-1)*(I+1))=p(-1+h*(i-1),2)-h*h2(-1+h*(i-1));
     A(i+(j-1)*(I+1),i+(j-2)*(I+1))=-p(-1+h*(i-1),2);
     b(i+(j-1)*(I+1))=g2(-1+h*(i-1));
 end
 %右边界上的点 x=1
 i=I+1;
 for j=2:1:J+1
     A(i+(j-1)*(I+1),i+(j-1)*(I+1))=p(1,-2+h*(j-1))-h*h1(-2+h*(j-1));
     A(i+(j-1)*(I+1),i-1+(j-1)*(I+1))=-p(1,-2+h*(j-1));
     b(i+(j-1)*(I+1))=g1(-2+h*(j-1));
 end
 %下边界上的点 y=-2
 j=1;
 for i=2:1:I+1
      A(i+(j-1)*(I+1),i+(j-1)*(I+1))=p(-1+h*(i-1),-2)-h*fh2(-1+h*(i-1));
      A(i+(j-1)*(I+1),i+j*(I+1))=-p(-1+h*(i-1),-2);
      b(i+(j-1)*(I+1))=fg2(-1+h*(i-1));
 end
 x=gmres(A,b');
 for i=1:1:I+1
     for j=1:1:J+1
         B(i,j)=x(i+(j-1)*(I+1));
     end
 end
 x=[-1:h:1];
 y=[-2:h:2];
 surf(x,y,B');
